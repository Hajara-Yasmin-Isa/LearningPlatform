# Supabase Database Schema

This directory contains all database schema definitions and seed data.

## Structure

```
supabase/
├── migrations/          # SQL files that create and modify tables
│   └── README.md       # Migration guidelines
└── seed/               # Sample data for testing
    └── README.md       # Seeding guidelines
```

## Key Principles

1. **All schema changes must be in SQL files**
   - Never create tables manually in Supabase UI
   - Always commit migration files to Git

2. **Migrations are sequential**
   - Name files with incrementing numbers: `001_`, `002_`, etc.
   - Each migration builds on the previous one

3. **Row Level Security (RLS) is mandatory**
   - Every table must have RLS enabled
   - All policies must be defined in migrations

## Example Migration Workflow

1. Create a new migration file:
```sql
-- migrations/001_create_lessons.sql

-- Create the table
CREATE TABLE lessons (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  title TEXT NOT NULL,
  description TEXT,
  lesson_order INTEGER NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE lessons ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Anyone can view lessons"
  ON lessons FOR SELECT
  TO authenticated
  USING (true);
```

2. Test locally first
3. Commit to Git
4. Open PR for review

## For Backend Contributors

If you're working on database schema:
- Read the full guide in `/migrations/README.md`
- Review existing migrations before creating new ones
- Test all changes locally

## For Frontend Contributors

You should **NOT** need to modify files in this directory.

Your work assumes:
- Tables already exist
- APIs are auto-generated by Supabase
- Data is secured by RLS

If you think you need to change the schema:
1. Talk to the backend team first
2. Create a Trello card
3. Let backend owners handle the migration

## Running Migrations

Migrations are applied automatically by Supabase when:
- You push to the `dev` or `main` branch
- The backend team applies them manually

You do not need to run migrations yourself unless you're on the backend team.

## Questions?

- Backend work: Check `/migrations/README.md`
- General questions: Ask in Slack
- Schema confusion: Tag backend owners in Trello